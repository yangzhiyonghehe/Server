(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72d25dc5"],{"09f4":function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),Math.easeInOutQuad=function(e,t,n,i){return e/=i/2,e<1?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)};var i=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function a(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function r(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function s(e,t,n){var s=r(),o=e-s,c=20,l=0;t="undefined"===typeof t?500:t;var u=function e(){l+=c;var r=Math.easeInOutQuad(l,s,o,t);a(r),l<t?i(e):n&&"function"===typeof n&&n()};u()}},2870:function(e,t,n){"use strict";var i=n("c5db"),a=n.n(i);a.a},"2f29":function(e,t,n){},"2fd4":function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"l",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"g",(function(){return p})),n.d(t,"f",(function(){return h})),n.d(t,"i",(function(){return f})),n.d(t,"j",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"h",(function(){return y})),n.d(t,"c",(function(){return _})),n.d(t,"e",(function(){return w}));n("456d"),n("ac6a"),n("96cf");var i=n("3b8d"),a=n("b775"),r=n("5c96");function s(e){return Object(a["a"])({url:"/attendance_rule/list",method:"get",params:e})}function o(e){return c.apply(this,arguments)}function c(){return c=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t);case 3:return e.abrupt("return",Object(a["a"])({url:"/attendance_rule/update",method:"post",timeout:12e4,data:t}));case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",Promise.reject());case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),c.apply(this,arguments)}function l(e){return u.apply(this,arguments)}function u(){return u=Object(i["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m(t);case 3:return e.abrupt("return",Object(a["a"])({url:"/attendance_rule/create",timeout:12e4,method:"post",data:t}));case 6:return e.prev=6,e.t0=e["catch"](0),e.abrupt("return",Promise.reject());case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),u.apply(this,arguments)}function d(e){return Object(a["a"])({url:"/attendance_rule/delete",method:"post",data:e})}function p(e){return Object(a["a"])({url:"/attendance_rule/fix_attendance",method:"post",data:e,timeout:6e4})}function m(e){return new Promise((function(t,n){Object(a["a"])({url:"/attendance_rule/check_person",method:"post",data:e}).then((function(e){var i=e.data;if(i.names.length<=0)t("");else{for(var a=[],s="",o=0;o<i.names.length;o++){if(o>=3){s="等".concat(i.names.length,"人");break}a.push(i.names[o])}s="["+a.join(",")+"]"+s,r["MessageBox"].confirm("".concat(s,"原考勤规则会被覆盖，确定吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t("")})).catch((function(){n("")}))}}))}))}function h(e){return Object(a["a"])({url:"/attendance_rule/fetchTakeTurns",method:"get",params:{id:e}})}function f(e){return v.apply(this,arguments)}function v(){return v=Object(i["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,n=[],Object.keys(t.persons).forEach((function(e){t.persons[e]&&n.push(e)})),e.next=5,m(Object.assign({person:n},t));case 5:return e.abrupt("return",Object(a["a"])({url:"/attendance_rule/saveTakeTurns",method:"post",data:t}));case 8:return e.prev=8,e.t0=e["catch"](0),e.abrupt("return",Promise.reject());case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),v.apply(this,arguments)}function g(e){return Object(a["a"])({url:"/attendance_rule/schedule",method:"post",data:e})}function b(e){return Object(a["a"])({url:"/attendance_rule/selectedPersons",method:"get",params:e})}function y(e){return Object(a["a"])({url:"/attendance/list",method:"get",params:e})}function _(e){return Object(a["a"])({url:"/attendance/export",method:"get",timeout:12e4,params:e})}function w(e){return Object(a["a"])({url:"/attendance/snap",method:"get",params:e})}},3123:function(e,t,n){"use strict";n("7f7f");var i=n("b775"),a=n("bc3a"),r=n.n(a),s=n("5c96"),o=r.a.create({baseURL:"/api/management",timeout:5e3});o.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),o.interceptors.response.use((function(e){var t=e.data;return t}),(function(e){return console.log("err"+e),Object(s["Message"])({message:e.message,type:"error",duration:5e3}),Promise.reject(e)}));var c=o,l=n("69a0"),u=n.n(l);function d(e){return new Promise((function(t,n){var i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,a=new FileReader,r=2097152,s=Math.ceil(e.size/r),o=0,c=new u.a;function l(){var t=o*r,n=t+r>=e.size?e.size:t+r;a.readAsBinaryString(i.call(e,t,n))}a.onload=function(e){c.appendBinary(e.target.result),o++,o<s?l():t(c.end())},a.onerror=function(){n("FileReader error.")},l()}))}var p=n("7f6d");function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(i["a"])({url:"/qiniu/token",method:"get",params:{filename:e,original:t}})}function h(e){return Object(i["a"])({url:"/qiniu/upload",method:"post",data:e,timeout:6e4})}function f(e){return c({url:"http:"===window.location.protocol?"http://up.qiniu.com/":"https://up.qbox.me/",method:"post",data:e,timeout:6e4})}function v(e){return"LAN"===p["a"]?b(e):new Promise((function(t,n){d(e).then((function(a){Object(i["a"])({url:"/qiniu/md5file",method:"get",params:{hash:a}}).then((function(n){var r=n.data;r["hashfile"]?t(r["url"]):g(e,!0).then((function(e){setTimeout((function(){Object(i["a"])({url:"/qiniu/savecache",method:"post",data:{hash:a,url:e}})}),1),t(e)}))})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))}))}function g(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"LAN"===p["a"]?b(e):new Promise((function(n,i){m(e.name,t).then((function(t){var a=t.data.qiniu_url,r=new FormData;r.append("token",t.data.qiniu_token),r.append("key",t.data.qiniu_key),r.append("file",e),f(r).then((function(){n(a)})).catch((function(e){i("上传失败了，请重试")}))})).catch((function(e){i("出现未知问题，刷新页面，或联系管理员")}))}))}function b(e){return new Promise((function(t,n){var i=new FormData;i.append("file",e),h(i).then((function(e){t(e.url)})).catch((function(e){n("上传失败了，请重试")}))}))}n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return g}))},3903:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("div",{staticClass:"filter-container"},[n("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreate}},[e._v(e._s(e.$t("user.add")))]),e._v(" "),n("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-upload"},on:{click:function(t){return e.handleSyncDevice()}}},[e._v(e._s(e.$t("user.syncBtn")))]),e._v(" "),n("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:e.$t("attendance.keyword")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleFilter(t)}},model:{value:e.listQuery.keyword,callback:function(t){e.$set(e.listQuery,"keyword",t)},expression:"listQuery.keyword"}}),e._v(" "),n("organize-select",{staticStyle:{width:"180px"},attrs:{selected:e.listQuery.organizations,organizations:e.organizations},on:{"update:selected":function(t){return e.$set(e.listQuery,"organizations",t)}}}),e._v(" "),n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleFilter}},[e._v("\n      "+e._s(e.$t("table.search"))+"\n    ")])],1),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.list,border:"",fit:"","highlight-current-row":""},on:{"sort-change":e.sortChange}},[n("el-table-column",{attrs:{label:"ID",prop:"id",sortable:"custom",align:"center",width:"80","class-name":e.getSortClass("id")},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("span",[e._v(e._s(i.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("user.name"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("span",[e._v(e._s(i.name))]),e._v(" "),i.is_admin?n("el-tag",{staticClass:"sm",attrs:{type:"success"}},[e._v(e._s(e.$t("user.tag.manager")))]):e._e(),e._v(" "),i.working?e._e():n("el-tag",{staticClass:"sm",attrs:{type:"info"}},[e._v(e._s(e.$t("user.tag.leave")))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("user.organize"),"min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("span",[e._v(e._s(i.organization))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("user.phone"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("span",[e._v(e._s(i.phone))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("table.actions"),align:"center",width:"350","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.handleUpdate(i)}}},[e._v(e._s(e.$t("table.edit")))]),e._v(" "),"deleted"!=i.status?n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(i)}}},[e._v(e._s(e.$t("table.delete")))]):e._e(),e._v(" "),"LAN"!==e.runmode?n("el-button",{staticStyle:{width:"auto"},attrs:{type:i.admin_id<1?"info":"success",size:"mini"},on:{click:function(t){return e.handleBindAdmin(i)}}},[e._v(e._s(e.$t("user.bindManager")))]):e._e()]}}])})],1),e._v(" "),n("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.listQuery.page,limit:e.listQuery.limit},on:{"update:page":function(t){return e.$set(e.listQuery,"page",t)},"update:limit":function(t){return e.$set(e.listQuery,"limit",t)},pagination:e.getList}}),e._v(" "),n("el-dialog",{attrs:{title:e.$t("user.table"),visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[n("div",{staticClass:"form-dialog"},[n("el-form",{ref:"dataForm",staticClass:"form-wrap",staticStyle:{width:"400px","margin-left":"50px"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"100px"}},[n("el-form-item",{attrs:{label:e.$t("user.name"),prop:"name"}},[n("el-input",{model:{value:e.temp.name,callback:function(t){e.$set(e.temp,"name",t)},expression:"temp.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.phone"),prop:"phone"}},[n("el-input",{model:{value:e.temp.phone,callback:function(t){e.$set(e.temp,"phone",t)},expression:"temp.phone"}})],1),e._v(" "),n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:e.$t("user.tab.basic"),name:"first"}},[n("el-form-item",{attrs:{label:e.$t("user.organization"),prop:"organizations"}},[n("el-tree",{ref:"organizationTree",attrs:{data:e.organizations,"show-checkbox":"","node-key":"id","default-expand-all":!0,"default-checked-keys":e.selected_organizations,props:e.defaultProps},on:{check:e.handleTree}})],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.pic"),prop:"pic"}},[n("div",{staticClass:"upload-wrap"},[n("el-upload",{class:{"avatar-uploader":!0,uploaded:e.temp.pic},attrs:{action:"","show-file-list":!1,"on-remove":e.handleRemove,"http-request":e.handleUpload,"on-change":e.changeFile,"auto-upload":!0},model:{value:e.temp.pic,callback:function(t){e.$set(e.temp,"pic",t)},expression:"temp.pic"}},[e.imageUrl?n("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):n("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),e._v(" "),n("span",{staticClass:"after"},[e._v(e._s(e.$t("user.form.avatarPlaceholder")))])]),e._v(" "),n("div",{staticClass:"choose",on:{click:e.handleChoose}},[n("span",{class:{close:e.snapVisable}},[e._v(e._s(e.$t("user.form.stranger")))])])],1)]),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.form.workStatus"),prop:"working",required:""}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("user.form.workTips"),placement:"right"}},[n("el-switch",{attrs:{"active-text":e.$t("user.tag.working")},model:{value:e.temp.working,callback:function(t){e.$set(e.temp,"working",t)},expression:"temp.working"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("table.sort"),prop:"sort"}},[n("el-input",{model:{value:e.temp.sort,callback:function(t){e.$set(e.temp,"sort",t)},expression:"temp.sort"}})],1)],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("user.tab.device"),name:"second"}},[n("el-form-item",{attrs:{label:e.$t("user.device"),prop:"open_devices"}},[n("el-checkbox-group",{attrs:{size:"small"},model:{value:e.open_devices,callback:function(t){e.open_devices=t},expression:"open_devices"}},e._l(e.devices,(function(t){return n("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.form.remote"),prop:"remote_devices"}},[n("el-checkbox-group",{attrs:{size:"small"},model:{value:e.remote_devices,callback:function(t){e.remote_devices=t},expression:"remote_devices"}},e._l(e.devices,(function(t){return n("el-checkbox",{key:t.id,attrs:{label:t.id,disabled:e.open_devices.indexOf(t.id)<0}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),n("el-tab-pane",{attrs:{label:e.$t("user.tab.auth"),name:"third"}},[n("el-form-item",{attrs:{label:e.$t("user.form.setAdmin"),prop:"is_admin"}},[n("el-switch",{model:{value:e.temp.is_admin,callback:function(t){e.$set(e.temp,"is_admin",t)},expression:"temp.is_admin"}})],1),e._v(" "),"LAN"===e.runmode?n("el-form-item",{attrs:{label:e.$t("user.form.password"),prop:"password"}},[n("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:e.$t("user.form.passPlaceholder"),name:"password",disabled:!e.temp.is_admin},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password",t)},expression:"temp.password"}}),e._v(" "),n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("svg-icon",{attrs:{"icon-class":"password"===e.passwordType?"eye":"eye-open"}})],1)],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.form.incharges"),prop:"in_charges"}},[n("el-checkbox-group",{attrs:{size:"small"},model:{value:e.in_charges,callback:function(t){e.in_charges=t},expression:"in_charges"}},e._l(e.organizes_box,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.id,disabled:!e.temp.is_admin||!t.valid}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:e.$t("user.form.incharges")}},[n("el-checkbox-group",{attrs:{size:"small"},model:{value:e.temp.rights,callback:function(t){e.$set(e.temp,"rights",t)},expression:"temp.rights"}},e._l(e.rights,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.label,disabled:!e.temp.is_admin}},[e._v(e._s(t.name))])})),1)],1)],1)],1)],1),e._v(" "),e.snapVisable?n("div",{staticClass:"snap-wrap"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.snapData,height:"100%"}},[n("el-table-column",{attrs:{label:e.$t("user.snap.pic"),width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[n("img",{staticStyle:{"object-fit":"fill",cursor:"pointer"},attrs:{src:i.pic,height:"50px"},on:{click:function(t){return e.choosePic(i)}}})]}}],null,!1,890549972)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("user.snap.time"),prop:"time",width:"100"}})],1),e._v(" "),n("div",{staticClass:"loadinmore"},[e.snapLoading?n("span",[e._v(e._s(e.$t("user.snap.loading")))]):n("div",[e.snapMore?n("span",{staticClass:"loadbtn",on:{click:e.loadingSnap}},[e._v(e._s(e.$t("user.snap.load")))]):n("span",[e._v(e._s(e.$t("user.snap.nomore")))])])])],1):e._e()],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-checkbox",{model:{value:e.temp.sync,callback:function(t){e.$set(e.temp,"sync",t)},expression:"temp.sync"}},[e._v(e._s(e.temp.working?e.$t("user.syncBtn"):e.$t("user.removeBtn")))]),e._v(" "),n("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){"create"===e.dialogStatus?e.createData():e.updateData()}}},[e._v(e._s(e.$t("table.confirm")))])],1)]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogSync,width:"30%"},on:{"update:visible":function(t){e.dialogSync=t}}},[n("template",{slot:"title"},[n("div",{staticClass:"sync-title"},[e._v("\n        "+e._s(e.$t("user.sync.title"))+"\n        "),n("span",[e._v("（"+e._s(e.$t("user.sync.sync"))+"）")])])]),e._v(" "),n("div",[n("div",e._l(e.devices,(function(t,i){return n("section",{key:i,staticClass:"progress"},[n("div",{staticClass:"pro"},[e.progresses[t["id"]]?n("el-progress",{attrs:{percentage:e.percentages[t["id"]],color:e.customColors,"show-text":!1}}):e._e()],1),e._v(" "),e.progresses[t["id"]]&&"break"===e.progresses[t["id"]]["status"]?n("div",{staticClass:"retry"},[n("el-button",{attrs:{icon:"el-icon-refresh-right",circle:"",type:"primary",size:"mini",disabled:e.syncTemp["sync"]},on:{click:function(n){return e.handleRefresh(t["id"])}}})],1):e._e(),e._v(" "),n("div",{staticClass:"dev"},[e._v(e._s(t["name"]))])])})),0),e._v(" "),n("transition",{attrs:{name:"el-fade-in"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.syncCompleted,expression:"syncCompleted"}],staticStyle:{"text-align":"center","margin-top":"20px",color:"#67C23A"}},[n("i",{staticClass:"el-icon-circle-check",staticStyle:{"font-size":"35px"}})])])],1)],2),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogUserBind,width:"65%"},on:{"update:visible":function(t){e.dialogUserBind=t}}},[n("template",{slot:"title"},[e._v("\n      "+e._s(e.$t("user.bindUser"))+"\n    ")]),e._v(" "),n("user-bind",{ref:"userBind",attrs:{adminid:e.bindUser.adminid,isadmin:e.bindUser.isadmin},on:{"update:adminid":function(t){return e.$set(e.bindUser,"adminid",t)},"update:isadmin":function(t){return e.$set(e.bindUser,"isadmin",t)}}}),e._v(" "),n("el-divider",{staticClass:"mobile-bind-line"},[n("i",{staticClass:"el-icon-mobile-phone"},[e._v(e._s(e.$t("user.bind")))])]),e._v(" "),n("div",[n("el-popover",{attrs:{placement:"right",title:e.$t("user.bindStep"),width:"230",trigger:"hover"}},[n("div",{staticClass:"inv-wrap",attrs:{slot:"reference"},slot:"reference"},[n("div",{ref:"qrCodeUrl",staticClass:"qrcode"}),e._v(" "),n("div",{staticClass:"invcode"},[e._v(e._s(e.invcode))])]),e._v(" "),n("div",[n("img",{attrs:{src:"https://qiniu.organize.wanglitiaoyi.cn/images/bind-help1.gif"}})])])],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogUserBind=!1}}},[e._v(e._s(e.$t("table.cancel")))]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.saveInv}},[e._v(e._s(e.$t("table.saveOptions")))])],1)],2)],1)},a=[],r=(n("7f7f"),n("55dd"),n("ac4d"),n("8a81"),n("6762"),n("2fdb"),n("5df3"),n("4f7f"),n("75fc")),s=(n("6b54"),n("ac6a"),n("28a5"),n("3f6e")),o=n("aa98"),c=n("d368"),l=n("2fd4"),u=n("6724"),d=n("333d"),p=n("4e4a"),m=n("3123"),h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{},[n("el-form",{attrs:{"label-width":"100px"}},[n("el-form-item",{attrs:{label:e.$t("user.bindUser")}},[n("el-input",{staticClass:"input-with-select",attrs:{disabled:e.adminid>0,placeholder:e.$t("user.bindUserTips")},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[n("el-button",{attrs:{slot:"append",disabled:e.adminid>0,icon:"el-icon-search"},on:{click:e.searchUser},slot:"append"})],1)],1),e._v(" "),e.searched?n("div",{staticClass:"select-wrap"},[e.user.avatar?n("div",{staticClass:"user-wrap"},[n("div",{staticClass:"wrap-left"},[n("div",{staticClass:"user-box",on:{click:e.handleUnbind}},[n("img",{attrs:{src:e.user.avatar}})]),e._v(" "),n("div",{staticClass:"user-name"},[n("div",[e._v(e._s(e.user.account))]),e._v(" "),n("div",[e._v(e._s(e.user.mobile))])])])]):n("div",{staticClass:"info"},[n("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.$t("user.bindEmpty")))])],1)]):e._e()],1)],1)},f=[],v=(n("c5f6"),{name:"UserBind",props:{adminid:{type:Number,default:0},isadmin:{type:Boolean,default:!1}},data:function(){return{keyword:"",searched:!1,origid:null,avatar:"",user:{},devices:{},is_admin:!1}},watch:{user:{deep:!0,handler:function(e,t){e["id"]!==this.adminid&&this.$emit("update:adminid",e["id"])}},adminid:function(e,t){0===e&&(this.searched=!1),this.fetch()}},mounted:function(){this.fetch()},methods:{fetch:function(){this.origid=parseInt(this.adminid),this.is_admin=this.isadmin,this.origid>0?this.fetchAdmin({adminid:this.adminid}):this.resetUser()},resetUser:function(){this.is_admin=!1,this.user=Object.assign({},{id:0,isadmin:!1,avatar:null})},handleUnbind:function(){var e=this;this.origid===this.adminid?this.$confirm(this.$t("user.delete.unbind"),"").then((function(){e.searched=!1,e.resetUser()})):this.resetUser()},searchUser:function(){this.fetchAdmin({keyword:this.keyword})},fetchAdmin:function(e){var t=this;Object(s["d"])(e).then((function(e){t.searched=!0,e.data?(t.user=e.data,t.avatar=t.user["avatar"]):t.resetUser()}))}}}),g=v,b=(n("78b1"),n("2877")),y=Object(b["a"])(g,h,f,!1,null,"b2abf4b0",null),_=y.exports,w=n("d044"),k=n.n(w),$={name:"List",components:{Pagination:d["a"],UserBind:_,OrganizeSelect:p["a"]},directives:{waves:u["a"]},data:function(){return{statusMap:{0:this.$t("user.syncStatus.s0"),1:this.$t("user.syncStatus.s1"),2:this.$t("user.syncStatus.s2")},activeName:"first",snapData:[],snapVisable:!1,snapLoading:!1,snapMore:!0,snapPage:1,tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,limit:20,name:void 0,sort:"+id",organizations:[],keyword:""},imageUrl:"",devices:[],open_devices:[],remote_devices:[],organizes:[],in_charges:[],organizations:[],allSelect:!1,selected_organizations:[],defaultProps:{children:"children",label:"name"},bindUser:{id:void 0,adminid:null},percentages:{},progresses:{},customColors:[{color:"#e6a23c",percentage:10},{color:"#409eff",percentage:99},{color:"#67c23a",percentage:100}],dialogSync:!1,dialogUserBind:!1,syncCompleted:!1,invcode:"",rights:[{name:this.$t("user.rights.person"),label:"person"},{name:this.$t("user.rights.attendance"),label:"attendance"},{name:this.$t("user.rights.face"),label:"face"},{name:this.$t("user.rights.circuitbreaker"),label:"circuitbreaker"}],temp:{},syncTemp:[],errorStack:{},dialogFormVisible:!1,dialogStatus:"",rules:{name:[{required:!0,message:this.$t("user.required.name"),trigger:"blur"}],phone:[{required:!0,message:this.$t("user.required.phone"),trigger:"blur"}],organizations:[{required:!0,message:this.$t("user.required.organizations"),trigger:"blur"}],pic:[{required:!0,message:this.$t("user.required.pic"),trigger:"blur"}]},downloadLoading:!1,passwordType:"password",action:"http:"===window.location.protocol?"http://up.qiniu.com/":"https://up.qbox.me/"}},computed:{organizes_box:function(){var e=[],t=this.temp.organizations.split(",");this.organizes.forEach((function(n){t.indexOf(n.id.toString())>=0&&e.push.apply(e,[n].concat(Object(r["a"])(n.parent)))}));var n=Object(r["a"])(new Set(e));return this.allSelect&&n.unshift({id:0,name:this.$t("user.rights.all"),valid:!0}),n}},created:function(){this.resetTemp(),this.getList(),this.getDeviceOptions(),this.getAllOrgOptions()},methods:{handleBindAdmin:function(e){var t=this;this.dialogUserBind=!0,this.invcode=e.invcode,this.bindUser={id:e.id,adminid:e.admin_id},this.$nextTick((function(){t.renderQrCode(e.invcode)}))},saveInv:function(){var e=this;Object(s["a"])(this.bindUser).then((function(t){e.dialogUserBind=!1,e.$notify({title:e.$t("table.successTitle"),message:e.$t("table.updateSuccess"),type:"success",duration:2e3}),e.getList()})).catch((function(){e.dialogUserBind=!1}))},handleTree:function(e,t){this.temp.organizations=this.$refs.organizationTree.getCheckedKeys().join(",")},getList:function(){var e=this;this.listLoading=!0,Object(s["e"])(this.listQuery).then((function(t){e.list=t.data.items,e.total=t.data.total,e.listLoading=!1}))},handleFilter:function(){this.listQuery.page=1,this.getList()},sortChange:function(e){var t=e.prop,n=e.order;"id"===t&&this.sortByID(n)},sortByID:function(e){this.listQuery.sort="ascending"===e?"+id":"-id",this.handleFilter()},showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick((function(){e.$refs.password.focus()}))},resetTemp:function(){this.temp={id:void 0,name:"",phone:"",devices:[],is_admin:!1,rights:[],pic:"",organizations:"",sort:0,working:!0,sync:!0},this.imageUrl="",this.open_devices=[],this.remote_devices=[],this.selected_organizations=[],this.cleanTreePerson()},choosePic:function(e){this.temp.pic=e.pic,this.imageUrl=e.pic},handleChoose:function(){if(this.snapVisable)return this.snapVisable=!1,!1;this.snapVisable=!0,this.snapData=[],this.snapPage=1,this.loadingSnap()},loadingSnap:function(){var e=this;this.snapLoading=!0,this.snapMore=!0,Object(l["e"])({page:this.snapPage}).then((function(t){var n;e.snapLoading=!1,e.snapPage+=1,(n=e.snapData).push.apply(n,Object(r["a"])(t.data.items)),e.snapData.length>=t.data.total&&(e.snapMore=!1)})).catch((function(t){e.snapLoading=!1}))},handleSyncDevice:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.syncTemp={sync:!1},this.dialogSync=!0,this.syncCompleted=!1,this.progresses={},this.devices.forEach((function(n){e.progresses[n.id]={total:1,next:0,status:"",persons:t},e.$set(e.percentages,n.id,0)})),this.syncDevices(this.devices,t)},handleRefresh:function(e){var t=this.devices.filter((function(t){return t.id===e})),n=this.progresses[e]["persons"];this.syncDevices(t,n)},syncDevices:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.syncTemp["sync"])return"";this.syncTemp["sync"]=!0;var i=e.concat(),a=i[0];Object(s["h"])(Object.assign(a,{next:this.progresses[a.id]["next"],persons:n})).then((function(e){t.syncTemp["sync"]=!1,t.errorStack={};var r=e.data;if(!r)return t.$set(t.percentages,a.id,100),!0;t.progresses[a.id]={total:r.total,next:r.next,status:"",persons:n},t.$set(t.percentages,a.id,r.next/r.total*100),100===t.percentages[a.id]&&i.shift(),i.length>0?setTimeout((function(){t.syncDevices(i,n)}),1):(t.syncCompleted=!0,t.getList())})).catch((function(e){t.syncTemp["sync"]=!1,t.errorStack&&t.errorStack["id"]===a.id||(t.errorStack={id:a.id,error:0}),e.message.includes("timeout")?(t.errorStack["error"]+=1,t.errorStack["error"]>=5?(t.progresses[a.id]["status"]="break",i.shift(),i.length>0?setTimeout((function(){t.syncDevices(i,n)}),1):t.syncCompleted=!0):(t.$message({message:t.$t("table.continueMessage"),type:"warning"}),setTimeout((function(){t.syncDevices(i,n)}),1))):(t.progresses[a.id]["status"]="",t.$message({message:e.message||t.$t("table.syncError"),type:"error"}))}))},handleCreate:function(){var e=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.in_charges=[],this.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))},createData:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t){e.temp.devices=e.open_devices,e.temp.organizations=e.$refs.organizationTree.getCheckedKeys().join(","),e.temp.in_charges=e.in_charges,e.temp.remote_devices=e.remote_devices;var n=e.temp.sync;Object(s["b"])(e.temp).then((function(t){e.temp=t.data,e.in_charges=e.temp["in_charges"],e.list.unshift(e.temp),e.dialogFormVisible=!1,e.$notify({title:e.$t("table.successTitle"),message:e.$t("table.updateSuccess"),type:"success",duration:2e3}),n&&e.handleSyncDevice([e.temp.id])}))}}))},handleUpdate:function(e){var t=this;this.temp=Object.assign({},e,{is_admin:!!e.is_admin,sync:!1}),this.imageUrl=this.temp.pic,this.in_charges=this.temp["in_charges"],this.remote_devices=e.remote_devices,this.selected_organizations=this.temp.organizations.split(","),this.dialogStatus="update",this.dialogFormVisible=!0,this.open_devices=e.devices,this.cleanTreePerson(),this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},updateData:function(){var e=this;this.$refs["dataForm"].validate((function(t){if(t){e.temp.devices=e.open_devices,e.temp.organizations=e.$refs.organizationTree.getCheckedKeys().join(","),e.temp.remote_devices=e.remote_devices,e.temp.in_charges=e.in_charges;var n=Object.assign({},e.temp),i=e.temp.sync;Object(s["j"])(n).then((function(){var t=!0,n=!1,a=void 0;try{for(var r,s=e.list[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var o=r.value;if(o.id===e.temp.id){var c=e.list.indexOf(o);e.list.splice(c,1,e.temp);break}}}catch(l){n=!0,a=l}finally{try{t||null==s.return||s.return()}finally{if(n)throw a}}e.dialogFormVisible=!1,e.$notify({title:e.$t("table.successTitle"),message:e.$t("table.updateSuccess"),type:"success",duration:2e3}),i&&e.handleSyncDevice([e.temp.id])}))}}))},handleDelete:function(e){var t=this;this.$confirm(this.$t("user.delete.confirm"),this.$t("table.confirmTitle"),{confirmButtonText:this.$t("table.confirm"),cancelButtonText:this.$t("table.cancel"),type:"warning"}).then((function(){Object(s["c"])(e).then((function(){t.$notify({title:t.$t("table.successTitle"),message:t.$t("table.deleteSuccess"),type:"success",duration:2e3});var n=t.list.indexOf(e);t.list.splice(n,1)}))}))},renderQrCode:function(e){this.$refs.qrCodeUrl.innerHTML="",new k.a(this.$refs.qrCodeUrl,{text:e,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:k.a.CorrectLevel.H})},changeFile:function(e,t){if("LAN"!==this.runmode)return!1;var n=this,i=new FileReader;i.readAsDataURL(e.raw),i.onload=function(e){n.loading=!1,n.temp.pic=this.result,n.imageUrl=n.temp.pic}},handleUpload:function(e){var t=this;return"LAN"!==this.runmode&&new Promise((function(n,i){Object(m["b"])(e.file).then((function(e){t.loading=!1,t.temp.pic=e,t.imageUrl=t.temp.pic,n(!0)})).catch((function(e){t.loading=!1,i(!1)}))}))},handleRemove:function(e){this.imageUrl=""},getSortClass:function(e){var t=this.listQuery.sort;return t==="+".concat(e)?"ascending":t==="-".concat(e)?"descending":""},getDeviceOptions:function(){var e=this;Object(o["c"])().then((function(t){e.devices=t.data}))},getPersonSelectedDevice:function(){var e=this;Object(s["g"])({person_id:this.temp.id}).then((function(t){e.open_devices=t.data}))},getAllOrgOptions:function(){var e=this;Object(c["a"])().then((function(t){var n=t.data;e.organizations=n.tree,e.allSelect=n.all,e.organizes=e.parseOrganize(n.tree)}))},parseOrganize:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=[];return e.forEach((function(e){var a={id:e.id,name:e.name,valid:e.valid,parent:n};e.children&&i.push.apply(i,Object(r["a"])(t.parseOrganize(e.children,[a].concat(Object(r["a"])(n))))),i.push(a)})),i},cleanTreePerson:function(){"undefined"!==typeof this.$refs.organizationTree&&"undefined"!==this.$refs.organizationTree.setCheckedKeys&&this.$refs.organizationTree.setCheckedKeys([])}}},O=$,j=(n("2870"),Object(b["a"])(O,i,a,!1,null,"7d39aeac",null));t["default"]=j.exports},"3f6e":function(e,t,n){"use strict";n.d(t,"e",(function(){return a})),n.d(t,"j",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"i",(function(){return p})),n.d(t,"d",(function(){return m}));var i=n("b775");function a(e){return Object(i["a"])({url:"/person/list",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/person/update",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/person/create",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/person/delete",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/person/personSelectedDevice",method:"post",params:e})}function l(e){return Object(i["a"])({url:"/person/personOrgOptions",method:"post",params:e})}function u(e){return Object(i["a"])({url:"/person/sync",method:"post",hiddenMsg:!0,data:e})}function d(e){return Object(i["a"])({url:"/person/bindAdmin",method:"post",data:e})}function p(e){return Object(i["a"])({url:"/person/unbind",method:"post",data:{company_id:e}})}function m(e){return Object(i["a"])({url:"/person/fetchAdmin",method:"post",data:e})}},"4e4a":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-select",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:e.$t("organiz.choosePlaceholder")},model:{value:e.mySelected,callback:function(t){e.mySelected=t},expression:"mySelected"}},e._l(e.options,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)},a=[],r=(n("7f7f"),n("75fc")),s=(n("ac6a"),n("d368")),o={name:"OrganizeSelect",props:{selected:{type:Array,default:function(){return[]}},organizations:{type:Array,default:function(){return[]}},diy:{type:Boolean,default:!1}},data:function(){return{myOrganizations:[],mySelected:[],options:[]}},watch:{mySelected:function(e,t){this.$emit("update:selected",e)},organizations:function(e,t){this.myOrganizations=this.organizations,this.loadOptions()}},mounted:function(){var e=this;this.mySelected=this.selected,this.myOrganizations=this.organizations,this.loadOptions(),this.diy&&Object(s["a"])().then((function(t){e.myOrganizations=t.data.tree,e.loadOptions()}))},methods:{loadOptions:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[];if(0===n&&(t=this.myOrganizations),t.forEach((function(t){i.push(e.renderOptions(t,n)),t.children&&t.children.length>0&&i.push.apply(i,Object(r["a"])(e.loadOptions(t.children,n+1)))})),0!==n)return i;this.options=i},renderOptions:function(e,t){var n="-------------".substring(0,t);return{id:e.id,name:n+e.name}}}},c=o,l=n("2877"),u=Object(l["a"])(c,i,a,!1,null,"cce91c64",null);t["a"]=u.exports},6724:function(e,t,n){"use strict";n("8d41");var i="@@wavesContext";function a(e,t){function n(n){var i=Object.assign({},t.value),a=Object.assign({ele:e,type:"hit",color:"rgba(0, 0, 0, 0.15)"},i),r=a.ele;if(r){r.style.position="relative",r.style.overflow="hidden";var s=r.getBoundingClientRect(),o=r.querySelector(".waves-ripple");switch(o?o.className="waves-ripple":(o=document.createElement("span"),o.className="waves-ripple",o.style.height=o.style.width=Math.max(s.width,s.height)+"px",r.appendChild(o)),a.type){case"center":o.style.top=s.height/2-o.offsetHeight/2+"px",o.style.left=s.width/2-o.offsetWidth/2+"px";break;default:o.style.top=(n.pageY-s.top-o.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",o.style.left=(n.pageX-s.left-o.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return o.style.backgroundColor=a.color,o.className="waves-ripple z-active",!1}}return e[i]?e[i].removeHandle=n:e[i]={removeHandle:n},n}var r={bind:function(e,t){e.addEventListener("click",a(e,t),!1)},update:function(e,t){e.removeEventListener("click",e[i].removeHandle,!1),e.addEventListener("click",a(e,t),!1)},unbind:function(e){e.removeEventListener("click",e[i].removeHandle,!1),e[i]=null,delete e[i]}},s=function(e){e.directive("waves",r)};window.Vue&&(window.waves=r,Vue.use(s)),r.install=s;t["a"]=r},"78b1":function(e,t,n){"use strict";var i=n("2f29"),a=n.n(i);a.a},"8d41":function(e,t,n){},aa98:function(e,t,n){"use strict";n.d(t,"f",(function(){return a})),n.d(t,"r",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"q",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"n",(function(){return u})),n.d(t,"p",(function(){return d})),n.d(t,"l",(function(){return p})),n.d(t,"t",(function(){return m})),n.d(t,"s",(function(){return h})),n.d(t,"k",(function(){return f})),n.d(t,"e",(function(){return v})),n.d(t,"d",(function(){return g})),n.d(t,"m",(function(){return b})),n.d(t,"j",(function(){return y})),n.d(t,"o",(function(){return _})),n.d(t,"h",(function(){return w})),n.d(t,"i",(function(){return k})),n.d(t,"g",(function(){return $}));var i=n("b775");function a(e){return Object(i["a"])({url:"/device/list",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/device/update",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/device/changePassword",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/device/bind",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/device/unbind",method:"post",data:e})}function l(e){return Object(i["a"])({url:"/device/deviceOptions",method:"get",params:e})}function u(e){return Object(i["a"])({url:"/device/selectedPersons",method:"get",params:e})}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(i["a"])({url:"/device/truncate",method:"post",data:{id:e}})}function p(e){return Object(i["a"])({url:"/device/reboot",method:"post",data:{id:e}})}function m(e){return Object(i["a"])({url:"/device/version",method:"post",data:{id:e}})}function h(e){var t=e.id,n=e.path;return Object(i["a"])({url:"/device/upgrade",method:"post",data:{id:t,path:n},timeout:3e4})}function f(e){return Object(i["a"])({url:"/device/opendoor",method:"post",data:{id:e}})}function v(e){return Object(i["a"])({url:"/device/enableAlarm",method:"post",data:e})}function g(){return Object(i["a"])({url:"/device/devicesByGroup",method:"get"})}function b(e){return Object(i["a"])({url:"/device/saveGroup",method:"post",data:e})}function y(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(i["a"])({url:"/device/keepOpendoor",method:"post",data:{id:e,open:t}})}function _(e){return Object(i["a"])({url:"/device/status",method:"post",data:{ids:e}})}function w(e){return Object(i["a"])({url:"/device/getExtend",method:"get",params:{id:e}})}function k(e){return Object(i["a"])({url:"/device/getLog",method:"get",params:{id:e}})}function $(e){return Object(i["a"])({url:"/device/getAlarmLog",method:"get",params:{id:e}})}},c5db:function(e,t,n){},d368:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l}));var i=n("b775");function a(e){return Object(i["a"])({url:"/organization/list",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/organization/getRootOrgOptions",method:"get",params:e})}function s(e){return Object(i["a"])({url:"/organization/getAllOrgOptions",method:"get",params:e})}function o(e){return Object(i["a"])({url:"/organization/update",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/organization/create",method:"post",data:e})}function l(e){return Object(i["a"])({url:"/organization/delete",method:"post",data:e})}}}]);