(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73666372"],{"04f7":function(t,e,i){"use strict";var a=i("1958"),n=i.n(a);n.a},1708:function(t,e,i){},1958:function(t,e,i){},"19fd":function(t,e,i){"use strict";var a=i("1708"),n=i.n(a);n.a},"1c8c":function(t,e,i){"use strict";var a=i("90cb"),n=i.n(a);n.a},"1d5f":function(t,e,i){"use strict";var a=i("513d"),n=i.n(a);n.a},3227:function(t,e,i){},"461a":function(t,e,i){"use strict";var a=i("6ba1"),n=i.n(a);n.a},"513d":function(t,e,i){},"65dd":function(t,e,i){"use strict";var a=i("9d66"),n=i.n(a);n.a},"6ba1":function(t,e,i){},"8efd":function(t,e,i){},"90cb":function(t,e,i){},9406:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dashboard-container",style:{height:t.tagsView?"calc(100vh - 84px)":"100vh"}},[i("hamburger",{staticClass:"hamburger-container",attrs:{id:"hamburger-container","is-active":t.sidebar.opened},on:{toggleClick:t.toggleSideBar}}),t._v(" "),"dashboard"===t.mode?i("dashboard"):"ioConsoles"===t.mode?i("io-consoles"):i("consoles")],1)},n=[],s=i("db72"),o=i("2f62"),r=i("4f1e"),c=i("fcac"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dashboard-editor-container"},[i("div",{staticClass:"control-wrap"},[t.consoles.length>1?[i("el-dropdown",{staticStyle:{display:"inline",right:"20px"},attrs:{trigger:"click"},on:{command:t.handleConsole}},[i("div",{staticClass:"header-menu"},[i("i",{staticClass:"el-icon-s-opportunity"}),t._v(t._s(t.$t("dashboard.console.more")))]),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t._l(t.consoles,(function(e){return[e.runmodes.indexOf(t.runmode)>=0?i("el-dropdown-item",{key:e.name,attrs:{command:e.link}},[t._v(t._s(e.name))]):t._e()]}))],2)],1)]:[t.consoles.length>0&&t.consoles[0].runmodes.indexOf(t.runmode)>=0?i("el-link",{staticStyle:{display:"inline","margin-right":"20px"},attrs:{icon:"el-icon-s-opportunity",type:"primary"}},[i("router-link",{attrs:{to:t.consoles[0].link}},[t._v(t._s(t.consoles[0].name))])],1):t._e()],t._v(" "),i("switch-com",{staticClass:"right-menu-item",attrs:{id:"header-switch"}}),t._v(" "),i("i",{staticClass:"logout",on:{click:t.handleLogout}},[i("svg-icon",{attrs:{"icon-class":"logout","class-name":"icon-logout"}})],1)],2),t._v(" "),i("div",{staticClass:"wrap-1"},[i("section",{staticClass:"topbox"},[i("bar-chart")],1),t._v(" "),i("section",{staticClass:"bottombox"},[i("div",{staticClass:"map-wrap"},["LAN"!==t.runmode?i("section",{staticStyle:{height:"100%"}},[i("div",{staticClass:"box-head"},[i("div",[t._v(t._s(t.$t("dashboard.alarm.status")))]),i("span",[t._v("Device Status")])]),t._v(" "),i("div",{staticClass:"box-body",staticStyle:{padding:"0 5px"}},[i("devices-table-chart")],1)]):i("pie-chart")],1),t._v(" "),i("div",{staticClass:"device-wrap"},["LAN"!==t.runmode?i("pie-chart"):i("statis-chart",{attrs:{statis:t.statis}})],1)])]),t._v(" "),i("div",{staticClass:"wrap-2"},["LAN"!==t.runmode?i("section",{staticClass:"topbox"},[i("statis-chart",{attrs:{statis:t.statis}})],1):t._e(),t._v(" "),i("section",{staticClass:"bottombox",style:{height:"LAN"!==t.runmode?"70%":"100%"}},[i("div",{staticClass:"box-head"},[i("div",[t._v(t._s(t.$t("dashboard.iOData")))]),i("span",[t._v("I/O Data")])]),t._v(" "),i("div",{staticClass:"box-body"},[i("table-chart",{ref:"iodata"})],1)])])])},d=[],u=(i("96cf"),i("3b8d")),h=(i("7514"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.className,style:{height:t.height,width:t.width}})}),f=[],m=(i("ac6a"),i("313e")),v=i.n(m),p=i("ed08"),b={data:function(){return{$_sidebarElm:null,$_resizeHandler:null}},mounted:function(){var t=this;this.$_resizeHandler=Object(p["b"])((function(){t.chart&&t.chart.resize()}),100),this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},beforeDestroy:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},activated:function(){this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},deactivated:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},methods:{$_initResizeEvent:function(){window.addEventListener("resize",this.$_resizeHandler)},$_destroyResizeEvent:function(){window.removeEventListener("resize",this.$_resizeHandler)},$_sidebarResizeHandler:function(t){"width"===t.propertyName&&this.$_resizeHandler()},$_initSidebarResizeEvent:function(){this.$_sidebarElm=document.getElementsByClassName("sidebar-container")[0],this.$_sidebarElm&&this.$_sidebarElm.addEventListener("transitionend",this.$_sidebarResizeHandler)},$_destroySidebarResizeEvent:function(){this.$_sidebarElm&&this.$_sidebarElm.removeEventListener("transitionend",this.$_sidebarResizeHandler)}}},g=i("b775");function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(g["a"])({url:"/dashboard/attendanceStatistics",method:"get",params:t})}function y(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(g["a"])({url:"/dashboard/statis",method:"get",params:t})}function x(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(g["a"])({url:"/dashboard/statusStatistics",method:"get",params:t})}function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(g["a"])({url:"/dashboard/io_data",method:"post",data:t})}function w(t){return Object(g["a"])({url:"/dashboard/io_statistics",method:"post",data:t})}function C(t){return Object(g["a"])({url:"/dashboard/device_status",method:"post",data:t})}i("817d");var S={mixins:[b],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"300px"}},data:function(){return{chart:null,series:[],xAxisData:[],names:[]}},created:function(){var t=this;_().then((function(e){var i=e.data;t.xAxisData=i.xAxisData,i.series.forEach((function(e,a){t.names=i["names"],t.series.push({name:i["names"][a],type:"bar",data:e,animationDelay:function(t){return 10*t}})})),t.$nextTick((function(){t.initChart()}))}))},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=v.a.init(this.$el,"macarons"),this.chart.setOption({title:{text:this.$t("dashboard.attendanceStatistics"),textStyle:{color:"#9aa8d4",fontSize:12},subtext:"Attendance Statistics",subtextStyle:{fontSize:11,color:"#404d69",verticalAlign:"top"},top:10},legend:{data:this.names,textStyle:{color:"#fff"}},toolbox:{},tooltip:{},xAxis:{data:this.xAxisData,splitLine:{show:!1}},yAxis:{},series:this.series,animationEasing:"elasticOut",animationDelayUpdate:function(t){return 5*t}})}}},O=S,k=i("2877"),j=Object(k["a"])(O,h,f,!1,null,null,null),D=j.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"tableheader","row-class-name":"tablerow"}},[i("el-table-column",{attrs:{prop:"time",label:t.$t("dashboard.record.time"),width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("dashboard.record.pic"),width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("img",{staticStyle:{"object-fit":"fill"},attrs:{src:e.row.pic,height:"30px"},on:{click:function(i){return t.showPic(e.row.pic)}}})]}}])}),t._v(" "),t.showTemperature?i("el-table-column",{attrs:{label:t.$t("dashboard.record.temperature"),width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",{class:a.alarm?"red":"green"},[t._v(t._s(a.temperature))])]}}],null,!1,3403988044)}):t._e(),t._v(" "),i("el-table-column",{attrs:{prop:"person",label:t.$t("dashboard.record.name"),width:"100"}}),t._v(" "),i("el-table-column",{attrs:{prop:"device",label:t.$t("dashboard.record.device")}})],1),t._v(" "),i("el-dialog",{attrs:{title:t.$t("attendance.preview"),visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{"max-width":"100%","max-height":"100%"},attrs:{src:t.previewPic}})])])],1)},T=[],z={mixins:[b],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"100%"},autoResize:{type:Boolean,default:!0}},data:function(){return{previewPic:"",timer:!0,dialogVisible:!1,tableData:[],showTemperature:!1,isdestroy:!1}},computed:Object(s["a"])({},Object(o["c"])("user",["company"])),mounted:function(){this.isdestroy=!1,this.fetch(),this.delayFetch()},methods:{destroy:function(){this.isdestroy=!0},delayFetch:function(){var t=this;this.isdestroy||setTimeout((function(){"/dashboard"===t.$route["path"]&&t.fetch(),t.delayFetch()}),5e3)},fetch:function(){var t=this;$({company:this.company}).then((function(e){t.tableData=e.data,t.showTemperature=t.tableData.some((function(t){return void 0!==t.temperature}))}))},showPic:function(t){this.previewPic=t,this.dialogVisible=!0}}},A=z,V=(i("dd06"),Object(k["a"])(A,E,T,!1,null,null,null)),F=V.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-class-name":"tableheader","row-class-name":"tablerow"}},[i("el-table-column",{attrs:{prop:"name",label:t.$t("dashboard.alarm.name"),width:"140"}}),t._v(" "),i("el-table-column",{attrs:{label:t.$t("dashboard.alarm.status")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:t._f("onlineTagFilter")(e.row.status)}},[t._v("\n          "+t._s(t._f("statusFilter")(e.row.status))+"\n        ")]),t._v(" "),i("el-tag",{attrs:{type:t._f("openStatusFilterTag")(e.row.isopen)}},[t._v("\n          "+t._s(t._f("openStatusFilter")(e.row.isopen))+"\n        ")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"alarm_enable",label:t.$t("dashboard.alarm.status1"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-switch",{attrs:{"active-text":t.$t("dashboard.alarm.switch")},on:{change:function(i){return t.handleAlarm(e.row)}},model:{value:e.row.alarm_enable,callback:function(i){t.$set(e.row,"alarm_enable",i)},expression:"scope.row.alarm_enable"}})]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"isalarm",label:t.$t("dashboard.alarm.status2"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:t._f("openStatusFilterTag")(e.row.isalarm)}},[t._v("\n          "+t._s(t._f("alarmStatusFilter")(e.row.isalarm))+"\n        ")])]}}])})],1),t._v(" "),i("el-dialog",{attrs:{title:t.$t("attendance.preview"),visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{"max-width":"100%","max-height":"100%"},attrs:{src:t.previewPic}})])])],1)},P=[],L=i("aa98"),N=i("9923"),q={filters:{onlineTagFilter:function(t){var e={0:"info",1:"success","-1":"info"};return e[t]},openStatusFilterTag:function(t){var e={0:"success",1:"warning","-1":"info"};return e[t]},statusFilter:function(t){var e={0:N["b"].t("device.onlineStatus.offline"),1:N["b"].t("device.onlineStatus.online")};return e[t]},openStatusFilter:function(t){var e={0:N["b"].t("device.openStatus.open"),1:N["b"].t("device.openStatus.close"),"-1":N["b"].t("device.openStatus.unknow")};return e[t]},alarmStatusFilter:function(t){var e={0:N["b"].t("device.stateStatus.normal"),1:N["b"].t("device.stateStatus.abnormal")};return e[t]}},mixins:[b],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"100%"},autoResize:{type:Boolean,default:!0}},data:function(){return{previewPic:"",timer:!0,dialogVisible:!1,tableData:[],isdestroy:!1,device_ids:[],begin_time:null}},computed:Object(s["a"])({},Object(o["c"])("user",["company"])),mounted:function(){this.isdestroy=!1,this.fetch(),this.delayFetch()},methods:{handleAlarm:function(t){Object(L["e"])({id:t.id,alarm_enable:t.alarm_enable}).then((function(t){}))},destroy:function(){this.isdestroy=!0},delayFetch:function(){var t=this;this.isdestroy||setTimeout((function(){"/dashboard"===t.$route["path"]&&t.fetch(),t.delayFetch()}),6e4)},fetch:function(){var t=this,e=!this.begin_time;C({company:this.company,ids:this.device_ids,begin_time:this.begin_time}).then((function(i){var a=i.data,n=i.data.devices;e&&(t.begin_time=a.begin_time,n.forEach((function(e){t.device_ids.push(e.id)}))),t.tableData=n}))},showPic:function(t){this.previewPic=t,this.dialogVisible=!0}}},H=q,B=(i("19fd"),Object(k["a"])(H,R,P,!1,null,null,null)),I=B.exports,M=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.className,style:{height:t.height,width:t.width}})},K=[];i("817d");var W={mixins:[b],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"300px"}},data:function(){return{chart:null,pieData:[]}},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()})),x().then((function(e){t.pieData=e.data,t.$nextTick((function(){t.initChart()}))}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=v.a.init(this.$el,"macarons"),this.chart.setOption({title:{text:this.$t("dashboard.statisticsAttendance"),textStyle:{color:"#9aa8d4",fontSize:12},subtext:"Statistics Attendance",subtextStyle:{fontSize:11,color:"#404d69",verticalAlign:"top"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{left:"center",bottom:"0",data:this.$t("dashboard.sALegend")},series:[{name:"",type:"pie",roseType:"radius",radius:["0","55%"],center:["50%","50%"],data:this.pieData,animationEasing:"cubicInOut",animationDuration:2600}]})}}},X=W,G=Object(k["a"])(X,M,K,!1,null,null,null),J=G.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"box-head"},[i("div",[t._v(t._s(t.$t("dashboard.statisticsData")))]),i("span",[t._v("Statistics Data")])]),t._v(" "),i("div",{staticClass:"box-body"},[i("ul",{staticClass:"ul-statis"},[i("li",[t._m(0),t._v(" "),i("div",{staticClass:"data"},[i("p",[t._v(t._s(t.statis.total))]),t._v(" "),i("em",[t._v(t._s(t.$t("dashboard.sDOptioins.total")))])])]),t._v(" "),i("li",[t._m(1),t._v(" "),i("div",{staticClass:"data"},[i("p",[t._v(t._s(t.statis.alarm))]),t._v(" "),i("em",[t._v(t._s(t.$t("dashboard.sDOptioins.alarm")))])])]),t._v(" "),i("li",[t._m(2),t._v(" "),i("div",{staticClass:"data"},[i("p",[t._v(t._s(t.statis.online))]),t._v(" "),i("em",[t._v(t._s(t.$t("dashboard.sDOptioins.online")))])])]),t._v(" "),i("li",[t._m(3),t._v(" "),i("div",{staticClass:"data"},[i("p",[t._v(t._s(t.statis.offline))]),t._v(" "),i("em",[t._v(t._s(t.$t("dashboard.sDOptioins.offline")))])])])])])])},U=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-s-marketing"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-s-opportunity"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-s-help"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"icon"},[i("i",{staticClass:"el-icon-help"})])}],Q={name:"StatisChart",props:{statis:{type:Object,default:function(){}}}},Z=Q,tt=(i("65dd"),Object(k["a"])(Z,Y,U,!1,null,"41c66f32",null)),et=tt.exports,it=i("3b11"),at={name:"DashboardAdmin",components:{StatisChart:et,BarChart:D,DevicesTableChart:I,TableChart:F,PieChart:J,SwitchCom:it["a"]},data:function(){return{statis:{total:0,alarm:0,online:0,offline:0},consoles:[]}},computed:{company:function(){var t=this.$store.getters.company,e=this.$store.getters.companys,i=e.find((function(e){return e.id===t}));return i||{name:"",id:0}}},mounted:function(){var t=this;y().then((function(e){t.statis=e.data})),"LAN"===this.runmode&&this.consoles.push({id:1,name:this.$t("dashboard.devConsole.name"),runmodes:["LAN"],link:"/consoles"}),Object(c["c"])().then((function(e){var i=e.data;i.iocount&&t.consoles.push({id:2,name:t.$t("dashboard.iOConsole.name"),runmodes:["LAN","prod","dev"],link:"/ioconsoles"})}))},beforeDestroy:function(){this.$refs.iodata.destroy()},methods:{handleConsole:function(t){this.$router.push(t)},handleLogout:function(){var t=this;this.$confirm(this.$t("dashboard.logoutTitle"),this.$t("table.confirmTitle"),{confirmButtonText:this.$t("table.confirm"),cancelButtonText:this.$t("table.cancel"),type:"warning"}).then(Object(u["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("user/logout");case 2:t.$router.push("/login?redirect=".concat(t.$route.fullPath));case 3:case"end":return e.stop()}}),e)})))).catch((function(){return!1}))}}},nt=at,st=(i("b928"),Object(k["a"])(nt,l,d,!1,null,"b0f79968",null)),ot=st.exports,rt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main"},[i("div",{staticClass:"toolbar"},[t.onkeyStatus?i("el-button",{attrs:{disabled:t.executeing,type:"warning",icon:"el-icon-warning"},on:{click:t.oneKeyOpen}},[t._v("一键紧急开门")]):i("el-button",{attrs:{type:"primary",disabled:t.executeing,icon:"el-icon-warning"},on:{click:t.oneKeyOpen}},[t._v("一键紧急关门")]),t._v(" "),t.editmode?i("div",[i("el-button",{attrs:{type:"info",icon:"el-icon-close"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{type:"success",icon:"el-icon-check"},on:{click:t.save}},[t._v("保存")])],1):i("el-button",{attrs:{type:"primary",icon:"el-icon-s-flag"},on:{click:t.handleEdit}},[t._v("编辑")])],1),t._v(" "),i("div",{staticClass:"tiles"},t._l(t.drags,(function(e,a){return i("el-row",{key:a,class:{draggingrow:t.editmode},attrs:{gutter:10}},[i("el-col",{staticClass:"tiles-title",attrs:{span:24}},[t.editmode?i("el-input",{staticClass:"input",attrs:{"prefix-icon":"el-icon-edit",placeholder:"请输入组内容"},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"drag.name"}}):i("span",[t._v(t._s(e.name))])],1),t._v(" "),i("draggable",{staticClass:"list-group",attrs:{disabled:!t.editmode,list:t.devices[a],options:{animation:150},"ghost-class":"ghost",group:"group1"},on:{start:function(e){t.dragging=!0},end:function(e){t.dragging=!1},change:t.change}},t._l(t.devices[a],(function(t){return i("el-col",{key:t.index,attrs:{span:4}},[i("tile",{ref:"tile",refInFor:!0,attrs:{device:t}})],1)})),1)],1)})),1)])},ct=[],lt=(i("7f7f"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"tile",attrs:{"element-loading-text":t.$t("dashboard.devConsole.loading"),"element-loading-spinner":"el-icon-loading"}},[i("div",{staticClass:"title"},[i("div",[i("i",{staticClass:"el-icon-coordinate"}),t._v(" "),i("span",[t._v(t._s(t.device.name))])]),t._v(" "),i("el-tag",{attrs:{size:"mini",type:t._f("statusFilter")(t.device.online)}},[t._v(t._s(t._f("statusTextFilter")(t.device.online)))])],1),t._v(" "),i("div",{staticClass:"ctrl"},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949",disabled:0==t.device.online},on:{change:t.keepOpendoor},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}}),t._v(" "),i("i",{class:{"el-icon-lock":t.status,"el-icon-unlock":!t.status},on:{click:t.opendoor}})],1),t._v(" "),i("div",[t._v(" ")])])}),dt=[],ut={filters:{statusFilter:function(t){var e={0:"info",1:"success"};return e[t]?e[t]:"default"},statusTextFilter:function(t){var e={0:N["b"].t("device.onlineStatus.offline"),1:N["b"].t("device.onlineStatus.online")};return e[t]?e[t]:N["b"].t("device.openStatus.unknow")}},props:{device:{type:Object,default:function(){return{status:0}}}},data:function(){return{value1:!1,status:"online",loading:!1}},watch:{"device.status":{deep:!0,handler:function(t,e){this.status=!!t}}},mounted:function(){this.status=!!this.device.status},methods:{opendoor:function(){var t=this;this.loading=!0,Object(L["k"])(this.device.id).then((function(e){t.loading=!1,t.$notify({title:t.$t("table.successTitle"),message:e.message||t.$t("device.openStatus.success"),type:"success",duration:2e3})})).catch((function(e){t.loading=!1,t.status=!t.status}))},keepOpendoor:function(){var t=this;this.keepOpen(!this.status).then((function(e){t.$notify({title:t.$t("table.successTitle"),message:e.message||t.$t("device.openStatus.success"),type:"success",duration:2e3})}))},keepOpen:function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(e){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,Object(L["j"])(this.device.id,e);case 3:return i=t.sent,this.loading=!1,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()}},ht=ut,ft=(i("dc24"),Object(k["a"])(ht,lt,dt,!1,null,"65a878d3",null)),mt=ft.exports,vt=i("1980"),pt=i.n(vt),bt={name:"Consoles",components:{tile:mt,draggable:pt.a},data:function(){return{drags:[],devices:[],dragging:!1,editmode:!1,ids:[],executeing:!1,tempData:{},onkeyStatus:!0,destroy:!1}},mounted:function(){var t=this;this.destroy=!1,Object(L["d"])().then((function(e){var i=e.data;i.forEach((function(e){t.drags.push({id:e.id,name:e.name}),t.devices.push(e.child)})),t.getDeviceIds()})),this.polling()},beforeDestroy:function(){this.destroy=!0},methods:{getDeviceIds:function(){var t=[];this.devices.forEach((function(e){e.forEach((function(e){t.push(e.id)}))})),this.ids=t},polling:function(){var t=this;this.destroy||("/consoles"===this.$route["path"]?this.editmode?setTimeout((function(){t.polling()}),5e3):Object(L["o"])(this.ids).then((function(e){var i=e.data;i.forEach((function(e){for(var i=0;i<t.devices.length;i++){for(var a=t.devices[i],n=!1,s=0;s<a.length;s++){var o=a[s];if(o.id===e.id){o.online=e.online,o.status=e.status,n=!0;break}}if(n)break}})),t.devices.splice(0,0),setTimeout((function(){t.polling()}),5e3)})):setTimeout((function(){t.polling()}),5e3))},oneKeyOpen:function(){var t=this;this.$confirm("确定要执行吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.executeing=!0,t.openDevice()})).catch((function(){}))},openDevice:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=0;if(this.devices.forEach((function(t){i+=t.length})),i<=e)return this.onkeyStatus=!this.onkeyStatus,this.executeing=!1,!1;this.$refs.tile[e].keepOpen(this.onkeyStatus).then((function(i){t.$notify({title:t.$t("table.successTitle"),message:i.message||"开门成功",type:"success",duration:2e3}),t.openDevice(++e)}))},handleEdit:function(){this.editmode=!0;var t=[];this.devices.forEach((function(e){t.push(e.concat())})),this.tempData={drags:this.drags.concat(),devices:t},this.endDrag()},change:function(t){t.added&&this.endDrag()},endDrag:function(){this.devices[this.devices.length-1].length>0&&(this.drags.push({name:"未命名",id:0}),this.devices.push([]))},cancel:function(){this.editmode=!1,this.drags=this.tempData.drags.concat(),this.devices=this.tempData.devices.concat(),this.destroyDrag()},save:function(){var t=this;this.editmode=!1;var e=this.drags.concat();e.forEach((function(e,i){var a=[];t.devices[i].forEach((function(t){a.push(t.id)})),e["ids"]=a})),Object(L["m"])(e).then((function(e){t.$notify({title:t.$t("table.successTitle"),message:e.message||"保存成功",type:"success",duration:2e3})})),this.destroyDrag()},destroyDrag:function(){this.tempData={};for(var t=this.devices.length-1,e=t;e>=0;e--){if(0!==this.devices[e].length)break;this.drags.splice(e,1),this.devices.splice(e,1)}}}},gt=bt,_t=(i("04f7"),Object(k["a"])(gt,rt,ct,!1,null,"cc872a48",null)),yt=_t.exports,xt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wrap",style:{color:t.config.textcolor,"background-color":t.config.bgcolor}},[i("div",{staticClass:"flex-wrap"},[i("div",{staticClass:"main-container"},[i("div",{staticClass:"title"},[t._v(t._s(t.company_name))]),t._v(" "),i("div",{staticClass:"led-content"},[t._v("\n        当前作业人数 "),i("span",{staticClass:"led-number"},[t._v(t._s(t.total))]),t._v(" 人\n      ")]),t._v(" "),t.config.detail?i("div",{staticClass:"led-detail"},[t.totals?i("marquee-y",[t._l(t.parseValue(t.totals),(function(e,a){return i("div",{key:a,staticClass:"my-listbox"},[[e[0]?i("div",{staticClass:"my-content"},[t._v(t._s(e[0]["orgname"])),i("span",{staticClass:"number"},[t._v(t._s(e[0]["count"]))]),t._v("人")]):t._e(),t._v(" "),e[1]?i("div",{staticClass:"my-content"},[t._v(t._s(e[1]["orgname"])),i("span",{staticClass:"number"},[t._v(t._s(e[1]["count"]))]),t._v("人")]):t._e()]],2)}))],2):t._e()],1):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.config.persondetail,expression:"config.persondetail"}],staticClass:"person_list"},t._l(t.iodata,(function(e,a){return i("div",{key:a,staticClass:"box"},[i("div",{staticClass:"avatar"},[i("img",{style:{"border-color":t.config.bordercolor},attrs:{src:e["pic"]?e["pic"]+"!avatar":"//qiniu.organize.wanglitiaoyi.cn/2019/10/noavatar.png"},on:{click:function(i){return t.showPic(e["pic"])}}})]),t._v(" "),i("div",{staticClass:"name"},[t._v(t._s(e["person"]))]),t._v(" "),i("div",{staticClass:"time",style:{color:t.config.textcolor+"99"}},[t._v(t._s(e["time"]))]),t._v(" "),i("div",{staticClass:"device",style:{color:t.config.textcolor+"66","border-color":t.config.bordercolor}},[t._v(t._s(e["device"]))])])})),0),t._v(" "),i("div",{staticClass:"tips"},[t.config.tips?i("marquee-x",{attrs:{"send-val":[t.config.tips]}}):t._e()],1)])]),t._v(" "),i("div",{staticClass:"settings"},[i("i",{staticClass:"el-icon-s-tools setting",on:{click:t.showDialog}})]),t._v(" "),i("el-dialog",{attrs:{title:"相关配置",visible:t.dialogSync},on:{"update:visible":function(e){t.dialogSync=e}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"400px","margin-left":"50px"},attrs:{model:t.temp,"label-position":"left","label-width":"80px"}},[i("el-form-item",{attrs:{label:"滚动标语"}},[i("el-input",{attrs:{type:"text",placeholder:"不显示请留空"},model:{value:t.temp.tips,callback:function(e){t.$set(t.temp,"tips",e)},expression:"temp.tips"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"重置人数"}},[i("el-switch",{attrs:{"active-text":"重置为0"},model:{value:t.temp.reset,callback:function(e){t.$set(t.temp,"reset",e)},expression:"temp.reset"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"部门详情"}},[i("el-switch",{attrs:{"active-text":"滚动显示部门人数详情"},model:{value:t.temp.detail,callback:function(e){t.$set(t.temp,"detail",e)},expression:"temp.detail"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"人员预览"}},[i("el-switch",{attrs:{"active-text":"显示最新人员出入预览"},model:{value:t.temp.persondetail,callback:function(e){t.$set(t.temp,"persondetail",e)},expression:"temp.persondetail"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"颜色设置"}},[i("el-color-picker",{staticStyle:{"vertical-align":"middle"},attrs:{size:"mini"},model:{value:t.temp.textcolor,callback:function(e){t.$set(t.temp,"textcolor",e)},expression:"temp.textcolor"}}),t._v(" "),i("span",{staticStyle:{"vertical-align":"middle",margin:"0 10px 0 0"}},[t._v("文字颜色")]),t._v(" "),i("el-color-picker",{staticStyle:{"vertical-align":"middle",margin:"0 5px 0 0"},attrs:{size:"mini"},model:{value:t.temp.bgcolor,callback:function(e){t.$set(t.temp,"bgcolor",e)},expression:"temp.bgcolor"}}),i("span",{staticStyle:{"vertical-align":"middle"}},[t._v("背景颜色")]),t._v(" "),i("el-color-picker",{staticStyle:{"vertical-align":"middle",margin:"0 5px 0 0"},attrs:{size:"mini"},model:{value:t.temp.bordercolor,callback:function(e){t.$set(t.temp,"bordercolor",e)},expression:"temp.bordercolor"}}),i("span",{staticStyle:{"vertical-align":"middle"}},[t._v("边框颜色")])],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogSync=!1}}},[t._v("\n        "+t._s(t.$t("table.cancel"))+"\n      ")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateData()}}},[t._v("\n        "+t._s(t.$t("table.confirm"))+"\n      ")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.$t("attendance.preview"),visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{"max-width":"100%","max-height":"100%"},attrs:{src:t.previewPic}})])])],1)},$t=[],wt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"outbox",staticClass:"my-outbox"},[i("div",{ref:"box",staticClass:"my-inbox"},t._l(t.marqueeVal,(function(e,a){return i("div",{key:a,staticClass:"my-list"},[t._v("\n      "+t._s(e)+"\n    ")])})),0)])},Ct=[],St={name:"MyMarqueeX",props:{sendVal:{type:Array,default:function(){return[]}}},data:function(){return{marqueeVal:""}},watch:{sendVal:function(t,e){this.marqueeVal=t}},mounted:function(){var t=this;this.marqueeVal=this.sendVal;var e=this.$refs.box,i=0;setInterval((function(){t.$refs.box&&t.$refs.outbox&&(t.$refs.box.offsetWidth<=t.$refs.outbox.offsetWidth||(i++,i>=e.offsetWidth/2&&(i=0),e.style="transform: translateX(-"+i+"px)"))}),16)}},Ot=St,kt=(i("1c8c"),Object(k["a"])(Ot,wt,Ct,!1,null,"e4d678e4",null)),jt=kt.exports,Dt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"outbox",staticClass:"my-outbox"},[i("div",{ref:"movebox",staticClass:"my-inbox"},[t._t("default")],2)])},Et=[],Tt={name:"MyMarqueeTop",data:function(){return{moveTarget:void 0,outbox:void 0,line_num:0,count_num:0}},mounted:function(){var t=this;this.moveTarget=this.$refs.movebox,this.outbox=this.$refs.outbox;var e=this.moveTarget,i=this.outbox,a=2e3;setInterval((function(){t.count_num=Math.round(e.offsetHeight/i.offsetHeight),i.offsetHeight<=e.offsetHeight/2&&t.marquee()}),a)},methods:{marquee:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.line_num,e=this.count_num,i=this.moveTarget,a=this.outbox;0===t&&(i.style.transition="transform .5s"),t++,t>e/2&&(t=0,i.style.transition="transform 0s"),i.style.transform="translateY(-"+t*a.offsetHeight+"px)",this.line_num=t}}},zt=Tt,At=(i("461a"),Object(k["a"])(zt,Dt,Et,!1,null,"d91ee838",null)),Vt=At.exports,Ft={name:"IoConsoles",components:{MarqueeX:jt,MarqueeY:Vt},data:function(){return{company_name:"",destroy:!1,dialogSync:!1,dialogVisible:!1,previewPic:"",config:{tips:"",detail:!1,textcolor:"",bgcolor:"",bordercolor:"",persondetail:!1},temp:{tips:"",reset:!1,detail:!1,textcolor:"",bgcolor:"",bordercolor:"",persondetail:!1},total:0,totals:[],iodata:[]}},computed:Object(s["a"])({},Object(o["c"])("user",["company"])),mounted:function(){this.destroy=!1,this.init(),this.load()},beforeDestroy:function(){this.destroy=!0},methods:{parseValue:function(t){var e=[];return t.forEach((function(t,i){var a=Math.floor(i/2);e[a]||(e[a]=[]),e[a][i%2]={orgname:t.orgname,count:t.count}})),e.push.apply(e,e),e},showDialog:function(){this.temp={tips:this.config.tips,reset:!1,detail:this.config.detail,bgcolor:this.config.bgcolor,textcolor:this.config.textcolor,bordercolor:this.config.bordercolor,persondetail:this.config.persondetail},this.dialogSync=!0},updateData:function(){var t=this;Object(c["a"])(this.temp).then((function(e){t.$notify({title:t.$t("table.successTitle"),message:t.$t("table.updateSuccess"),type:"success",duration:2e3}),t.temp.reset=!1,t.config=e.data,t.statistics(),t.dialogSync=!1}))},init:function(){var t=this;Object(c["e"])().then((function(e){t.company_name=e.data.name,t.config=e.data}))},load:function(){var t=this;this.destroy||(setTimeout((function(e){"/ioconsoles"===t.$route["path"]&&t.load()}),5e3),this.statistics())},statistics:function(){var t=this;w({company:this.company}).then((function(e){var i=e.data;t.total=i.count,t.totals=i.totals})),this.config.persondetail&&$({company:this.company}).then((function(e){t.iodata=e.data}))},showPic:function(t){t&&(this.previewPic=t,this.dialogVisible=!0)}}},Rt=Ft,Pt=(i("97fa"),Object(k["a"])(Rt,xt,$t,!1,null,"656fefd0",null)),Lt=Pt.exports,Nt={name:"Dashboard",components:{dashboard:ot,consoles:yt,ioConsoles:Lt,Hamburger:r["a"]},data:function(){return{mode:"dashboard"}},computed:Object(s["a"])({},Object(o["b"])(["roles","sidebar"]),{tagsView:function(){return this.$store.state.settings.tagsView}}),created:function(){var t=this;"/consoles"===this.$route.path?this.mode="consoles":"/ioconsoles"===this.$route.path&&(this.mode="ioConsoles"),Object(c["b"])().then((function(e){var i=e.data;if(1!==i["error"])return"";i["next"]?t.$msgbox({title:t.$t("table.confirmTitle"),message:e.message||t.$t("table.permissionDenied"),showClose:!1,callback:function(){t.$router.push(i["next"])}}):t.$msgbox({title:t.$t("table.confirmTitle"),message:e.message||t.$t("table.permissionDenied"),showClose:!1,callback:function(){t.$store.dispatch("user/resetToken").then((function(){location.reload()}))}})}))},methods:{toggleSideBar:function(){this.$store.dispatch("app/toggleSideBar")}}},qt=Nt,Ht=(i("1d5f"),Object(k["a"])(qt,a,n,!1,null,"4a65daaa",null));e["default"]=Ht.exports},"97fa":function(t,e,i){"use strict";var a=i("3227"),n=i.n(a);n.a},"9d66":function(t,e,i){},aa98:function(t,e,i){"use strict";i.d(e,"f",(function(){return n})),i.d(e,"r",(function(){return s})),i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return r})),i.d(e,"q",(function(){return c})),i.d(e,"c",(function(){return l})),i.d(e,"n",(function(){return d})),i.d(e,"p",(function(){return u})),i.d(e,"l",(function(){return h})),i.d(e,"t",(function(){return f})),i.d(e,"s",(function(){return m})),i.d(e,"k",(function(){return v})),i.d(e,"e",(function(){return p})),i.d(e,"d",(function(){return b})),i.d(e,"m",(function(){return g})),i.d(e,"j",(function(){return _})),i.d(e,"o",(function(){return y})),i.d(e,"h",(function(){return x})),i.d(e,"i",(function(){return $})),i.d(e,"g",(function(){return w}));var a=i("b775");function n(t){return Object(a["a"])({url:"/device/list",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/device/update",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/device/changePassword",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/device/bind",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/device/unbind",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/device/deviceOptions",method:"get",params:t})}function d(t){return Object(a["a"])({url:"/device/selectedPersons",method:"get",params:t})}function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Object(a["a"])({url:"/device/truncate",method:"post",data:{id:t}})}function h(t){return Object(a["a"])({url:"/device/reboot",method:"post",data:{id:t}})}function f(t){return Object(a["a"])({url:"/device/version",method:"post",data:{id:t}})}function m(t){var e=t.id,i=t.path;return Object(a["a"])({url:"/device/upgrade",method:"post",data:{id:e,path:i},timeout:3e4})}function v(t){return Object(a["a"])({url:"/device/opendoor",method:"post",data:{id:t}})}function p(t){return Object(a["a"])({url:"/device/enableAlarm",method:"post",data:t})}function b(){return Object(a["a"])({url:"/device/devicesByGroup",method:"get"})}function g(t){return Object(a["a"])({url:"/device/saveGroup",method:"post",data:t})}function _(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object(a["a"])({url:"/device/keepOpendoor",method:"post",data:{id:t,open:e}})}function y(t){return Object(a["a"])({url:"/device/status",method:"post",data:{ids:t}})}function x(t){return Object(a["a"])({url:"/device/getExtend",method:"get",params:{id:t}})}function $(t){return Object(a["a"])({url:"/device/getLog",method:"get",params:{id:t}})}function w(t){return Object(a["a"])({url:"/device/getAlarmLog",method:"get",params:{id:t}})}},b928:function(t,e,i){"use strict";var a=i("f249"),n=i.n(a);n.a},c364:function(t,e,i){},dc24:function(t,e,i){"use strict";var a=i("c364"),n=i.n(a);n.a},dd06:function(t,e,i){"use strict";var a=i("8efd"),n=i.n(a);n.a},f249:function(t,e,i){},fcac:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"f",(function(){return o})),i.d(e,"d",(function(){return r})),i.d(e,"a",(function(){return c})),i.d(e,"e",(function(){return l}));var a=i("b775");function n(){return Object(a["a"])({url:"/company/check",method:"get"})}function s(t){return Object(a["a"])({url:"/company/fetch",method:"get",params:t})}function o(t){return Object(a["a"])({url:"/company/update",method:"post",data:t})}function r(){return Object(a["a"])({url:"/company/getCompanyInfo",method:"post"})}function c(t){return Object(a["a"])({url:"/company/adjust_config",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/company/io_config",method:"post",data:t})}}}]);